
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{CNN}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \hypertarget{convolutional-neural-networks}{%
\section{Convolutional neural
networks}\label{convolutional-neural-networks}}

In this notebook, we'll put together our convolutional layers to
implement a 3-layer CNN. Then, we'll ask you to implement a CNN that can
achieve \textgreater{} 65\% validation error on CIFAR-10.

CS231n has built a solid API for building these modular frameworks and
training them, and we will use their very well implemented framework as
opposed to ``reinventing the wheel.'' This includes using their Solver,
various utility functions, their layer structure, and their
implementation of fast CNN layers. This also includes nndl.fc\_net,
nndl.layers, and nndl.layer\_utils. As in prior assignments, we thank
Serena Yeung \& Justin Johnson for permission to use code written for
the CS 231n class (cs231n.stanford.edu).

If you have not completed the Spatial BatchNorm Notebook, please see the
following description from that notebook:

Please copy and paste your prior implemented code from HW \#4 to start
this assignment. If you did not correctly implement the layers in HW
\#4, you may collaborate with a classmate to use their layer
implementations from HW \#4. You may also visit TA or Prof OH to correct
your implementation.

You'll want to copy and paste from HW \#4: - layers.py for your FC
network layers, as well as batchnorm and dropout. - layer\_utils.py for
your combined FC network layers. - optim.py for your optimizers.

Be sure to place these in the \texttt{nndl/} directory so they're
imported correctly. Note, as announced in class, we will not be
releasing our solutions.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{c+c1}{\PYZsh{} As usual, a bit of setup}
        
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{cnn} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{cs231n}\PY{n+nn}{.}\PY{n+nn}{data\PYZus{}utils} \PY{k}{import} \PY{n}{get\PYZus{}CIFAR10\PYZus{}data}
        \PY{k+kn}{from} \PY{n+nn}{cs231n}\PY{n+nn}{.}\PY{n+nn}{gradient\PYZus{}check} \PY{k}{import} \PY{n}{eval\PYZus{}numerical\PYZus{}gradient\PYZus{}array}\PY{p}{,} \PY{n}{eval\PYZus{}numerical\PYZus{}gradient}
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{conv\PYZus{}layers} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{cs231n}\PY{n+nn}{.}\PY{n+nn}{fast\PYZus{}layers} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{cs231n}\PY{n+nn}{.}\PY{n+nn}{solver} \PY{k}{import} \PY{n}{Solver}
        
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mf}{10.0}\PY{p}{,} \PY{l+m+mf}{8.0}\PY{p}{)} \PY{c+c1}{\PYZsh{} set default size of plots}
        \PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image.interpolation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nearest}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{plt}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image.cmap}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}
        
        \PY{c+c1}{\PYZsh{} for auto\PYZhy{}reloading external modules}
        \PY{c+c1}{\PYZsh{} see http://stackoverflow.com/questions/1907993/autoreload\PYZhy{}of\PYZhy{}modules\PYZhy{}in\PYZhy{}ipython}
        \PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} autoreload
        \PY{o}{\PYZpc{}}\PY{k}{autoreload} 2
        
        \PY{k}{def} \PY{n+nf}{rel\PYZus{}error}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}\PY{p}{:}
          \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} returns relative error \PYZdq{}\PYZdq{}\PYZdq{}}
          \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{x} \PY{o}{\PYZhy{}} \PY{n}{y}\PY{p}{)} \PY{o}{/} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{l+m+mf}{1e\PYZhy{}8}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{x}\PY{p}{)} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{c+c1}{\PYZsh{} Load the (preprocessed) CIFAR10 data.}
        
        \PY{n}{data} \PY{o}{=} \PY{n}{get\PYZus{}CIFAR10\PYZus{}data}\PY{p}{(}\PY{p}{)}
        \PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{data}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{k}\PY{p}{,} \PY{n}{data}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
X\_train: (49000, 3, 32, 32) 
y\_train: (49000,) 
X\_val: (1000, 3, 32, 32) 
y\_val: (1000,) 
X\_test: (1000, 3, 32, 32) 
y\_test: (1000,) 

    \end{Verbatim}

    \hypertarget{three-layer-cnn}{%
\subsection{Three layer CNN}\label{three-layer-cnn}}

In this notebook, you will implement a three layer CNN. The
\texttt{ThreeLayerConvNet} class is in \texttt{nndl/cnn.py}. You'll need
to modify that code for this section, including the initialization, as
well as the calculation of the loss and gradients. You should be able to
use the building blocks you have either earlier coded or that we have
provided. Be sure to use the fast layers.

The architecture of this CNN will be:

conv - relu - 2x2 max pool - affine - relu - affine - softmax

We won't use batchnorm yet. You've also done enough of these to know how
to debug; use the cells below.

Note: As we are implementing several layers CNN networks. The gradient
error can be expected for the \texttt{eval\_numerical\_gradient()}
function. If your \texttt{W1\ max\ relative\ error} and
\texttt{W2\ max\ relative\ error} are around or below 0.01, they should
be acceptable. Other errors should be less than 1e-5.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{n}{num\PYZus{}inputs} \PY{o}{=} \PY{l+m+mi}{2}
        \PY{n}{input\PYZus{}dim} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}
        \PY{n}{reg} \PY{o}{=} \PY{l+m+mf}{0.0}
        \PY{n}{num\PYZus{}classes} \PY{o}{=} \PY{l+m+mi}{10}
        \PY{n}{X} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randn}\PY{p}{(}\PY{n}{num\PYZus{}inputs}\PY{p}{,} \PY{o}{*}\PY{n}{input\PYZus{}dim}\PY{p}{)}
        \PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randint}\PY{p}{(}\PY{n}{num\PYZus{}classes}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{n}{num\PYZus{}inputs}\PY{p}{)}
        
        \PY{n}{model} \PY{o}{=} \PY{n}{ThreeLayerConvNet}\PY{p}{(}\PY{n}{num\PYZus{}filters}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,}
                                  \PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{n}{hidden\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{,}
                                  \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float64}\PY{p}{)}
        \PY{n}{loss}\PY{p}{,} \PY{n}{grads} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{loss}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}
        \PY{k}{for} \PY{n}{param\PYZus{}name} \PY{o+ow}{in} \PY{n+nb}{sorted}\PY{p}{(}\PY{n}{grads}\PY{p}{)}\PY{p}{:}
            \PY{n}{f} \PY{o}{=} \PY{k}{lambda} \PY{n}{\PYZus{}}\PY{p}{:} \PY{n}{model}\PY{o}{.}\PY{n}{loss}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{n}{param\PYZus{}grad\PYZus{}num} \PY{o}{=} \PY{n}{eval\PYZus{}numerical\PYZus{}gradient}\PY{p}{(}\PY{n}{f}\PY{p}{,} \PY{n}{model}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{n}{param\PYZus{}name}\PY{p}{]}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{h}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}6}\PY{p}{)}
            \PY{n}{e} \PY{o}{=} \PY{n}{rel\PYZus{}error}\PY{p}{(}\PY{n}{param\PYZus{}grad\PYZus{}num}\PY{p}{,} \PY{n}{grads}\PY{p}{[}\PY{n}{param\PYZus{}name}\PY{p}{]}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ max relative error: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{param\PYZus{}name}\PY{p}{,} \PY{n}{rel\PYZus{}error}\PY{p}{(}\PY{n}{param\PYZus{}grad\PYZus{}num}\PY{p}{,} \PY{n}{grads}\PY{p}{[}\PY{n}{param\PYZus{}name}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
W1 max relative error: 0.012412968840567237
W2 max relative error: 0.008041553409788594
W3 max relative error: 0.0004862342505233486
b1 max relative error: 1.2805332357663836e-05
b2 max relative error: 1.7912661187580383e-07
b3 max relative error: 9.438744972121686e-10

    \end{Verbatim}

    \hypertarget{overfit-small-dataset}{%
\subsubsection{Overfit small dataset}\label{overfit-small-dataset}}

To check your CNN implementation, let's overfit a small dataset.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{num\PYZus{}train} \PY{o}{=} \PY{l+m+mi}{100}
        \PY{n}{small\PYZus{}data} \PY{o}{=} \PY{p}{\PYZob{}}
          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{X\PYZus{}train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{X\PYZus{}train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{n}{num\PYZus{}train}\PY{p}{]}\PY{p}{,}
          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{n}{num\PYZus{}train}\PY{p}{]}\PY{p}{,}
          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{X\PYZus{}val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{X\PYZus{}val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{p}{\PYZcb{}}
        
        \PY{n}{model} \PY{o}{=} \PY{n}{ThreeLayerConvNet}\PY{p}{(}\PY{n}{weight\PYZus{}scale}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}2}\PY{p}{)}
        
        \PY{n}{solver} \PY{o}{=} \PY{n}{Solver}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{small\PYZus{}data}\PY{p}{,}
                        \PY{n}{num\PYZus{}epochs}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,}
                        \PY{n}{update\PYZus{}rule}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adam}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                        \PY{n}{optim\PYZus{}config}\PY{o}{=}\PY{p}{\PYZob{}}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{learning\PYZus{}rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,}
                        \PY{p}{\PYZcb{}}\PY{p}{,}
                        \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{print\PYZus{}every}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{solver}\PY{o}{.}\PY{n}{train}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(Iteration 1 / 20) loss: 2.442380
(Epoch 0 / 10) train acc: 0.230000; val\_acc: 0.164000
(Iteration 2 / 20) loss: 2.807926
(Epoch 1 / 10) train acc: 0.230000; val\_acc: 0.128000
(Iteration 3 / 20) loss: 2.479761
(Iteration 4 / 20) loss: 2.268477
(Epoch 2 / 10) train acc: 0.290000; val\_acc: 0.126000
(Iteration 5 / 20) loss: 2.206325
(Iteration 6 / 20) loss: 2.001906
(Epoch 3 / 10) train acc: 0.380000; val\_acc: 0.164000
(Iteration 7 / 20) loss: 1.714823
(Iteration 8 / 20) loss: 1.330315
(Epoch 4 / 10) train acc: 0.440000; val\_acc: 0.187000
(Iteration 9 / 20) loss: 1.674978
(Iteration 10 / 20) loss: 1.674314
(Epoch 5 / 10) train acc: 0.570000; val\_acc: 0.214000
(Iteration 11 / 20) loss: 1.044274
(Iteration 12 / 20) loss: 1.037084
(Epoch 6 / 10) train acc: 0.650000; val\_acc: 0.183000
(Iteration 13 / 20) loss: 0.955487
(Iteration 14 / 20) loss: 0.939063
(Epoch 7 / 10) train acc: 0.780000; val\_acc: 0.196000
(Iteration 15 / 20) loss: 0.895110
(Iteration 16 / 20) loss: 0.709071
(Epoch 8 / 10) train acc: 0.710000; val\_acc: 0.201000
(Iteration 17 / 20) loss: 0.976929
(Iteration 18 / 20) loss: 0.458233
(Epoch 9 / 10) train acc: 0.830000; val\_acc: 0.228000
(Iteration 19 / 20) loss: 0.428053
(Iteration 20 / 20) loss: 0.382610
(Epoch 10 / 10) train acc: 0.810000; val\_acc: 0.223000

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{solver}\PY{o}{.}\PY{n}{loss\PYZus{}history}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{loss}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{solver}\PY{o}{.}\PY{n}{train\PYZus{}acc\PYZus{}history}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{solver}\PY{o}{.}\PY{n}{val\PYZus{}acc\PYZus{}history}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{upper left}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{epoch}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{train-the-network}{%
\subsection{Train the network}\label{train-the-network}}

Now we train the 3 layer CNN on CIFAR-10 and assess its accuracy.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{model} \PY{o}{=} \PY{n}{ThreeLayerConvNet}\PY{p}{(}\PY{n}{weight\PYZus{}scale}\PY{o}{=}\PY{l+m+mf}{0.001}\PY{p}{,} \PY{n}{hidden\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{reg}\PY{o}{=}\PY{l+m+mf}{0.001}\PY{p}{)}
        
        \PY{n}{solver} \PY{o}{=} \PY{n}{Solver}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{data}\PY{p}{,}
                        \PY{n}{num\PYZus{}epochs}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,}
                        \PY{n}{update\PYZus{}rule}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adam}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                        \PY{n}{optim\PYZus{}config}\PY{o}{=}\PY{p}{\PYZob{}}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{learning\PYZus{}rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,}
                        \PY{p}{\PYZcb{}}\PY{p}{,}
                        \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{print\PYZus{}every}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
        \PY{n}{solver}\PY{o}{.}\PY{n}{train}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(Iteration 1 / 980) loss: 2.304607
(Epoch 0 / 1) train acc: 0.112000; val\_acc: 0.122000
(Iteration 21 / 980) loss: 2.431513
(Iteration 41 / 980) loss: 2.139178
(Iteration 61 / 980) loss: 1.838800
(Iteration 81 / 980) loss: 1.717134
(Iteration 101 / 980) loss: 1.776807
(Iteration 121 / 980) loss: 1.770716
(Iteration 141 / 980) loss: 1.692809
(Iteration 161 / 980) loss: 1.997805
(Iteration 181 / 980) loss: 1.639333
(Iteration 201 / 980) loss: 1.704571
(Iteration 221 / 980) loss: 1.718045
(Iteration 241 / 980) loss: 1.664037
(Iteration 261 / 980) loss: 1.788115
(Iteration 281 / 980) loss: 1.780202
(Iteration 301 / 980) loss: 1.877033
(Iteration 321 / 980) loss: 1.682954
(Iteration 341 / 980) loss: 1.583736
(Iteration 361 / 980) loss: 1.626821
(Iteration 381 / 980) loss: 1.683927
(Iteration 401 / 980) loss: 1.733259
(Iteration 421 / 980) loss: 1.762058
(Iteration 441 / 980) loss: 1.773177
(Iteration 461 / 980) loss: 1.698070
(Iteration 481 / 980) loss: 1.698333
(Iteration 501 / 980) loss: 1.836478
(Iteration 521 / 980) loss: 1.881817
(Iteration 541 / 980) loss: 1.569190
(Iteration 561 / 980) loss: 1.599625
(Iteration 581 / 980) loss: 1.743441
(Iteration 601 / 980) loss: 1.856654
(Iteration 621 / 980) loss: 1.352166
(Iteration 641 / 980) loss: 1.803098
(Iteration 661 / 980) loss: 1.641219
(Iteration 681 / 980) loss: 1.664610
(Iteration 701 / 980) loss: 1.421972
(Iteration 721 / 980) loss: 1.703242
(Iteration 741 / 980) loss: 1.519335
(Iteration 761 / 980) loss: 1.462877
(Iteration 781 / 980) loss: 1.707128
(Iteration 801 / 980) loss: 1.610267
(Iteration 821 / 980) loss: 1.419382
(Iteration 841 / 980) loss: 1.553902
(Iteration 861 / 980) loss: 1.398519
(Iteration 881 / 980) loss: 1.361531
(Iteration 901 / 980) loss: 1.830016
(Iteration 921 / 980) loss: 1.617584
(Iteration 941 / 980) loss: 1.360461
(Iteration 961 / 980) loss: 1.785666
(Epoch 1 / 1) train acc: 0.441000; val\_acc: 0.432000

    \end{Verbatim}

    \hypertarget{get-65-validation-accuracy-on-cifar-10.}{%
\section{Get \textgreater{} 65\% validation accuracy on
CIFAR-10.}\label{get-65-validation-accuracy-on-cifar-10.}}

In the last part of the assignment, we'll now ask you to train a CNN to
get better than 65\% validation accuracy on CIFAR-10.

\hypertarget{things-you-should-try}{%
\subsubsection{Things you should try:}\label{things-you-should-try}}

\begin{itemize}
\tightlist
\item
  Filter size: Above we used 7x7; but VGGNet and onwards showed stacks
  of 3x3 filters are good.\\
\item
  Number of filters: Above we used 32 filters. Do more or fewer do
  better?
\item
  Batch normalization: Try adding spatial batch normalization after
  convolution layers and vanilla batch normalization after affine
  layers. Do your networks train faster?
\item
  Network architecture: Can a deeper CNN do better? Consider these
  architectures:

  \begin{itemize}
  \tightlist
  \item
    {[}conv-relu-pool{]}xN - conv - relu - {[}affine{]}xM - {[}softmax
    or SVM{]}
  \item
    {[}conv-relu-pool{]}XN - {[}affine{]}XM - {[}softmax or SVM{]}
  \item
    {[}conv-relu-conv-relu-pool{]}xN - {[}affine{]}xM - {[}softmax or
    SVM{]}
  \end{itemize}
\end{itemize}

\hypertarget{tips-for-training}{%
\subsubsection{Tips for training}\label{tips-for-training}}

For each network architecture that you try, you should tune the learning
rate and regularization strength. When doing this there are a couple of
important things to keep in mind:

\begin{itemize}
\tightlist
\item
  If the parameters are working well, you should see improvement within
  a few hundred iterations
\item
  Remember the coarse-to-fine approach for hyperparameter tuning: start
  by testing a large range of hyperparameters for just a few training
  iterations to find the combinations of parameters that are working at
  all.
\item
  Once you have found some sets of parameters that seem to work, search
  more finely around these parameters. You may need to train for more
  epochs.
\end{itemize}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        \PY{c+c1}{\PYZsh{} YOUR CODE HERE:}
        \PY{c+c1}{\PYZsh{}   Implement a CNN to achieve greater than 65\PYZpc{} validation accuracy}
        \PY{c+c1}{\PYZsh{}   on CIFAR\PYZhy{}10.}
        \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        \PY{n}{model} \PY{o}{=} \PY{n}{ThreeLayerConvNet}\PY{p}{(}\PY{n}{weight\PYZus{}scale}\PY{o}{=}\PY{l+m+mf}{0.001}\PY{p}{,} \PY{n}{hidden\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{500}\PY{p}{,} \PY{n}{reg}\PY{o}{=}\PY{l+m+mf}{0.001}\PY{p}{)}
        
        \PY{n}{solver} \PY{o}{=} \PY{n}{Solver}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{data}\PY{p}{,}
                        \PY{n}{num\PYZus{}epochs}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{800}\PY{p}{,}
                        \PY{n}{update\PYZus{}rule}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adam}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                        \PY{n}{optim\PYZus{}config}\PY{o}{=}\PY{p}{\PYZob{}}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{learning\PYZus{}rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,}
                        \PY{p}{\PYZcb{}}\PY{p}{,}
                        \PY{n}{verbose}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{print\PYZus{}every}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
        \PY{n}{solver}\PY{o}{.}\PY{n}{train}\PY{p}{(}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        \PY{c+c1}{\PYZsh{} END YOUR CODE HERE}
        \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(Iteration 1 / 366) loss: 2.304618
(Epoch 0 / 6) train acc: 0.097000; val\_acc: 0.119000
(Iteration 21 / 366) loss: 1.791885
(Iteration 41 / 366) loss: 1.552661
(Iteration 61 / 366) loss: 1.402839
(Epoch 1 / 6) train acc: 0.540000; val\_acc: 0.506000
(Iteration 81 / 366) loss: 1.473061
(Iteration 101 / 366) loss: 1.323715
(Iteration 121 / 366) loss: 1.204466
(Epoch 2 / 6) train acc: 0.632000; val\_acc: 0.564000
(Iteration 141 / 366) loss: 1.236780
(Iteration 161 / 366) loss: 1.101894
(Iteration 181 / 366) loss: 1.102111
(Epoch 3 / 6) train acc: 0.640000; val\_acc: 0.608000
(Iteration 201 / 366) loss: 1.006382
(Iteration 221 / 366) loss: 1.054676
(Iteration 241 / 366) loss: 0.919030
(Epoch 4 / 6) train acc: 0.664000; val\_acc: 0.613000
(Iteration 261 / 366) loss: 0.946238
(Iteration 281 / 366) loss: 0.902880
(Iteration 301 / 366) loss: 0.857115
(Epoch 5 / 6) train acc: 0.696000; val\_acc: 0.630000
(Iteration 321 / 366) loss: 0.929277
(Iteration 341 / 366) loss: 0.847119
(Iteration 361 / 366) loss: 0.867971
(Epoch 6 / 6) train acc: 0.737000; val\_acc: 0.653000

    \end{Verbatim}

    \hypertarget{cnn.py}{%
\section{cnn.py}\label{cnn.py}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{conv\PYZus{}layers} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{cs231n}\PY{n+nn}{.}\PY{n+nn}{fast\PYZus{}layers} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{layer\PYZus{}utils} \PY{k}{import} \PY{o}{*}
        \PY{k+kn}{from} \PY{n+nn}{nndl}\PY{n+nn}{.}\PY{n+nn}{conv\PYZus{}layer\PYZus{}utils} \PY{k}{import} \PY{o}{*}
        
        \PY{k+kn}{import} \PY{n+nn}{pdb}
        
        \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} }
        \PY{l+s+sd}{This code was originally written for CS 231n at Stanford University}
        \PY{l+s+sd}{(cs231n.stanford.edu).  It has been modified in various areas for use in the}
        \PY{l+s+sd}{ECE 239AS class at UCLA.  This includes the descriptions of what code to}
        \PY{l+s+sd}{implement as well as some slight potential changes in variable names to be}
        \PY{l+s+sd}{consistent with class nomenclature.  We thank Justin Johnson \PYZam{} Serena Yeung for}
        \PY{l+s+sd}{permission to use this code.  To see the original version, please visit}
        \PY{l+s+sd}{cs231n.stanford.edu.  }
        \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        
        \PY{k}{class} \PY{n+nc}{ThreeLayerConvNet}\PY{p}{(}\PY{n+nb}{object}\PY{p}{)}\PY{p}{:}
            \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+sd}{    A three\PYZhy{}layer convolutional network with the following architecture:}
        
        \PY{l+s+sd}{    conv \PYZhy{} relu \PYZhy{} 2x2 max pool \PYZhy{} affine \PYZhy{} relu \PYZhy{} affine \PYZhy{} softmax}
        
        \PY{l+s+sd}{    The network operates on minibatches of data that have shape (N, C, H, W)}
        \PY{l+s+sd}{    consisting of N images, each with height H and width W and with C input}
        \PY{l+s+sd}{    channels.}
        \PY{l+s+sd}{    \PYZdq{}\PYZdq{}\PYZdq{}}
          
            \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{)}\PY{p}{,} \PY{n}{num\PYZus{}filters}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{,}
                       \PY{n}{hidden\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{num\PYZus{}classes}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{weight\PYZus{}scale}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,} \PY{n}{reg}\PY{o}{=}\PY{l+m+mf}{0.0}\PY{p}{,}
                       \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{float32}\PY{p}{,} \PY{n}{use\PYZus{}batchnorm}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
                \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+sd}{        Initialize a new network.}
        
        \PY{l+s+sd}{        Inputs:}
        \PY{l+s+sd}{        \PYZhy{} input\PYZus{}dim: Tuple (C, H, W) giving size of input data}
        \PY{l+s+sd}{        \PYZhy{} num\PYZus{}filters: Number of filters to use in the convolutional layer}
        \PY{l+s+sd}{        \PYZhy{} filter\PYZus{}size: Size of filters to use in the convolutional layer}
        \PY{l+s+sd}{        \PYZhy{} hidden\PYZus{}dim: Number of units to use in the fully\PYZhy{}connected hidden layer}
        \PY{l+s+sd}{        \PYZhy{} num\PYZus{}classes: Number of scores to produce from the final affine layer.}
        \PY{l+s+sd}{        \PYZhy{} weight\PYZus{}scale: Scalar giving standard deviation for random initialization}
        \PY{l+s+sd}{          of weights.}
        \PY{l+s+sd}{        \PYZhy{} reg: Scalar giving L2 regularization strength}
        \PY{l+s+sd}{        \PYZhy{} dtype: numpy datatype to use for computation.}
        \PY{l+s+sd}{        \PYZdq{}\PYZdq{}\PYZdq{}}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{use\PYZus{}batchnorm} \PY{o}{=} \PY{n}{use\PYZus{}batchnorm}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{reg} \PY{o}{=} \PY{n}{reg}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dtype} \PY{o}{=} \PY{n}{dtype}
        
            
            \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
            \PY{c+c1}{\PYZsh{} YOUR CODE HERE:}
            \PY{c+c1}{\PYZsh{}   Initialize the weights and biases of a three layer CNN. To initialize:}
            \PY{c+c1}{\PYZsh{}     \PYZhy{} the biases should be initialized to zeros.}
            \PY{c+c1}{\PYZsh{}     \PYZhy{} the weights should be initialized to a matrix with entries}
            \PY{c+c1}{\PYZsh{}         drawn from a Gaussian distribution with zero mean and }
            \PY{c+c1}{\PYZsh{}         standard deviation given by weight\PYZus{}scale.}
            \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        
                \PY{n}{C}\PY{p}{,} \PY{n}{H}\PY{p}{,} \PY{n}{W} \PY{o}{=} \PY{n}{input\PYZus{}dim}
              
                \PY{n}{size\PYZus{}W1} \PY{o}{=} \PY{p}{(}\PY{n}{num\PYZus{}filters}\PY{p}{,} \PY{n}{C}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{,} \PY{n}{filter\PYZus{}size}\PY{p}{)}
                \PY{n}{size\PYZus{}b1} \PY{o}{=} \PY{n}{num\PYZus{}filters}
        
                \PY{n}{Con\PYZus{}output} \PY{o}{=} \PY{p}{(}\PY{n}{num\PYZus{}filters}\PY{p}{,} \PY{n}{C}\PY{p}{,} \PY{n}{H}\PY{p}{,} \PY{n}{W}\PY{p}{)}
                \PY{n}{size\PYZus{}W2} \PY{o}{=} \PY{p}{(}\PY{n}{hidden\PYZus{}dim}\PY{p}{,}\PY{p}{(}\PY{n}{H}\PY{o}{/}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{p}{(}\PY{n}{W}\PY{o}{/}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{num\PYZus{}filters}\PY{p}{)}
                \PY{n}{size\PYZus{}b2} \PY{o}{=} \PY{n}{hidden\PYZus{}dim}
        
                \PY{n}{size\PYZus{}W3} \PY{o}{=} \PY{p}{(}\PY{n}{num\PYZus{}classes}\PY{p}{,} \PY{n}{hidden\PYZus{}dim}\PY{p}{)}
                \PY{n}{size\PYZus{}b3} \PY{o}{=} \PY{n}{num\PYZus{}classes}
        
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mf}{0.0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{n}{weight\PYZus{}scale}\PY{p}{,}\PY{n}{size} \PY{o}{=} \PY{n}{size\PYZus{}W1}\PY{p}{)}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{size\PYZus{}b1}\PY{p}{)}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mf}{0.0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{n}{weight\PYZus{}scale}\PY{p}{,}\PY{n}{size} \PY{o}{=} \PY{n}{size\PYZus{}W2}\PY{p}{)}\PY{o}{.}\PY{n}{T}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{size\PYZus{}b2}\PY{p}{)}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{normal}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+m+mf}{0.0}\PY{p}{,}\PY{n}{scale}\PY{o}{=}\PY{n}{weight\PYZus{}scale}\PY{p}{,}\PY{n}{size} \PY{o}{=} \PY{n}{size\PYZus{}W3}\PY{p}{)}\PY{o}{.}\PY{n}{T}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{size\PYZus{}b3}\PY{p}{)}
                
            \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
            \PY{c+c1}{\PYZsh{} END YOUR CODE HERE}
            \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        
                \PY{k}{for} \PY{n}{k}\PY{p}{,} \PY{n}{v} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{o}{.}\PY{n}{items}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                    \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n}{v}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{dtype}\PY{p}{)}
             
         
            \PY{k}{def} \PY{n+nf}{loss}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
        \PY{l+s+sd}{        Evaluate loss and gradient for the three\PYZhy{}layer convolutional network.}
        
        \PY{l+s+sd}{        Input / output: Same API as TwoLayerNet in fc\PYZus{}net.py.}
        \PY{l+s+sd}{        \PYZdq{}\PYZdq{}\PYZdq{}}
                \PY{n}{W1}\PY{p}{,} \PY{n}{b1} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
                \PY{n}{W2}\PY{p}{,} \PY{n}{b2} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
                \PY{n}{W3}\PY{p}{,} \PY{n}{b3} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        
                \PY{c+c1}{\PYZsh{} pass conv\PYZus{}param to the forward pass for the convolutional layer}
                \PY{n}{filter\PYZus{}size} \PY{o}{=} \PY{n}{W1}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}
                \PY{n}{conv\PYZus{}param} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stride}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pad}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{(}\PY{n}{filter\PYZus{}size} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{/} \PY{l+m+mi}{2}\PY{p}{\PYZcb{}}
        
                \PY{c+c1}{\PYZsh{} pass pool\PYZus{}param to the forward pass for the max\PYZhy{}pooling layer}
                \PY{n}{pool\PYZus{}param} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pool\PYZus{}height}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pool\PYZus{}width}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stride}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{2}\PY{p}{\PYZcb{}}
        
                \PY{n}{scores} \PY{o}{=} \PY{k+kc}{None}
            
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
                \PY{c+c1}{\PYZsh{} YOUR CODE HERE:}
                \PY{c+c1}{\PYZsh{}   Implement the forward pass of the three layer CNN.  Store the output}
                \PY{c+c1}{\PYZsh{}   scores as the variable \PYZdq{}scores\PYZdq{}.}
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
                
                \PY{c+c1}{\PYZsh{} passing conv\PYZhy{}ReLU\PYZhy{}Pool}
                \PY{n}{out\PYZus{}pool\PYZus{}fast}\PY{p}{,} \PY{n}{cache\PYZus{}pool\PYZus{}fast} \PY{o}{=} \PY{n}{conv\PYZus{}relu\PYZus{}pool\PYZus{}forward}\PY{p}{(}\PY{n}{X}\PY{p}{,}\PY{n}{W1}\PY{p}{,}\PY{n}{b1}\PY{p}{,}\PY{n}{conv\PYZus{}param}\PY{p}{,}\PY{n}{pool\PYZus{}param}\PY{p}{)}
                
                \PY{c+c1}{\PYZsh{} passing affine\PYZhy{}RelU}
                \PY{n}{out\PYZus{}affine\PYZus{}Relu\PYZus{}fast}\PY{p}{,} \PY{n}{cache\PYZus{}affine\PYZus{}Relu\PYZus{}fast} \PY{o}{=} \PY{n}{affine\PYZus{}relu\PYZus{}forward}\PY{p}{(}\PY{n}{out\PYZus{}pool\PYZus{}fast}\PY{p}{,} \PY{n}{W2}\PY{p}{,} \PY{n}{b2}\PY{p}{)}
                
                \PY{c+c1}{\PYZsh{} passing affine}
                \PY{n}{scores}\PY{p}{,} \PY{n}{cache\PYZus{}affine\PYZus{}fast} \PY{o}{=} \PY{n}{affine\PYZus{}forward}\PY{p}{(}\PY{n}{out\PYZus{}affine\PYZus{}Relu\PYZus{}fast}\PY{p}{,} \PY{n}{W3}\PY{p}{,} \PY{n}{b3}\PY{p}{)}
                                                           
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
                \PY{c+c1}{\PYZsh{} END YOUR CODE HERE}
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        
                \PY{k}{if} \PY{n}{y} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                    \PY{k}{return} \PY{n}{scores}
        
                \PY{n}{loss}\PY{p}{,} \PY{n}{grads} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{,} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
                
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
                \PY{c+c1}{\PYZsh{} YOUR CODE HERE:}
                \PY{c+c1}{\PYZsh{}   Implement the backward pass of the three layer CNN.  Store the grads}
                \PY{c+c1}{\PYZsh{}   in the grads dictionary, exactly as before (i.e., the gradient of }
                \PY{c+c1}{\PYZsh{}   self.params[k] will be grads[k]).  Store the loss as \PYZdq{}loss\PYZdq{}, and}
                \PY{c+c1}{\PYZsh{}   don\PYZsq{}t forget to add regularization on ALL weight matrices.}
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
                
                \PY{c+c1}{\PYZsh{} passing Softmax}
                \PY{n}{loss}\PY{p}{,} \PY{n}{dz} \PY{o}{=} \PY{n}{softmax\PYZus{}loss}\PY{p}{(}\PY{n}{scores}\PY{p}{,} \PY{n}{y}\PY{p}{)}
                \PY{n}{loss} \PY{o}{+}\PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{reg}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{W1}\PY{o}{*}\PY{n}{W1}\PY{p}{)} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{W2}\PY{o}{*}\PY{n}{W2}\PY{p}{)} \PY{o}{+} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{W3}\PY{o}{*}\PY{n}{W3}\PY{p}{)}\PY{p}{)}
                
                \PY{c+c1}{\PYZsh{} passing affine}
                \PY{n}{dh\PYZus{}affine}\PY{p}{,} \PY{n}{dw3}\PY{p}{,} \PY{n}{db3} \PY{o}{=} \PY{n}{affine\PYZus{}backward}\PY{p}{(}\PY{n}{dz}\PY{p}{,} \PY{n}{cache\PYZus{}affine\PYZus{}fast}\PY{p}{)}
                
                \PY{c+c1}{\PYZsh{} passing affine\PYZhy{}RelU}
                \PY{n}{dh\PYZus{}affine\PYZus{}relu}\PY{p}{,} \PY{n}{dw2}\PY{p}{,} \PY{n}{db2} \PY{o}{=} \PY{n}{affine\PYZus{}relu\PYZus{}backward}\PY{p}{(}\PY{n}{dh\PYZus{}affine}\PY{p}{,} \PY{n}{cache\PYZus{}affine\PYZus{}Relu\PYZus{}fast}\PY{p}{)}
                
                \PY{c+c1}{\PYZsh{} passing conv\PYZhy{}ReLU\PYZhy{}Pool}
                \PY{n}{dh\PYZus{}Conv}\PY{p}{,} \PY{n}{dw1}\PY{p}{,} \PY{n}{db1} \PY{o}{=} \PY{n}{conv\PYZus{}relu\PYZus{}pool\PYZus{}backward}\PY{p}{(}\PY{n}{dh\PYZus{}affine\PYZus{}relu}\PY{p}{,} \PY{n}{cache\PYZus{}pool\PYZus{}fast}\PY{p}{)}
        
                \PY{n}{grads}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{dw1} \PY{o}{+} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{reg} \PY{o}{*} \PY{n}{W1}
                \PY{n}{grads}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{db1}
                \PY{n}{grads}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{dw2} \PY{o}{+} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{reg} \PY{o}{*} \PY{n}{W2}
                \PY{n}{grads}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{db2}
                \PY{n}{grads}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{dw3} \PY{o}{+} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{reg} \PY{o}{*} \PY{n}{W3}
                \PY{n}{grads}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{db3}
                
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
                \PY{c+c1}{\PYZsh{} END YOUR CODE HERE}
                \PY{c+c1}{\PYZsh{} ================================================================ \PYZsh{}}
        
                \PY{k}{return} \PY{n}{loss}\PY{p}{,} \PY{n}{grads}
          
          
            \PY{k}{pass}
\end{Verbatim}



    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
